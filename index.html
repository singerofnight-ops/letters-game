<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–≤—É–∫–æ–≤–æ–π –ü–∞—Ä–æ–≤–æ–∑–∏–∫</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Tailwind CSS –¥–ª—è —Å—Ç–∏–ª–µ–π -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º React –∏ ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Babel –¥–ª—è –∑–∞–ø—É—Å–∫–∞ JSX –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ */
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes ping { 75%, 100% { transform: scale(2); opacity: 0; } }
        @keyframes pulse { 50% { opacity: .5; } }
        @keyframes bounce { 0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8,0,1,1); } 50% { transform: none; animation-timing-function: cubic-bezier(0,0,0.2,1); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
        
        .animate-spin { animation: spin 1s linear infinite; }
        .animate-ping { animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite; }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        .animate-bounce { animation: bounce 1s infinite; }
        .animate-shake { animation: shake 0.5s ease-in-out; }
        .animate-fade-in { animation: fade-in 0.3s ease-out; }
        
        .perspective-1000 { perspective: 1000px; }
        .preserve-3d { transform-style: preserve-3d; }
        .rotate-y-180 { transform: rotateY(180deg); }
        /* –°–∫—Ä—ã—Ç–∏–µ –∑–∞–¥–Ω–µ–π —á–∞—Å—Ç–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–∏ –≤—Ä–∞—â–µ–Ω–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –∑–¥–µ—Å—å —Å–¥–µ–ª–∞–Ω–æ —á–µ—Ä–µ–∑ overlay) */
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- –í–ê–® API –ö–õ–Æ–ß ---
        // –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AI —Ñ—É–Ω–∫—Ü–∏–∏ (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è, –æ–∑–≤—É—á–∫–∞) –Ω–∞ GitHub Pages,
        // –≤—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–π –∫–ª—é—á –Ω–∏–∂–µ –≤–Ω—É—Ç—Ä–∏ –∫–∞–≤—ã—á–µ–∫. –ù–∞–ø—Ä–∏–º–µ—Ä: const apiKey = "AIzaSy...";
        const apiKey = ""; 

        // --- –ò–ö–û–ù–ö–ò (SVG) ---
        // –ó–∞–º–µ–Ω—è–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É lucide-react –Ω–∞ –ø—Ä—è–º—ã–µ SVG –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–µ–∑ —Å–±–æ—Ä–∫–∏
        const Star = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>;
        const ChevronLeft = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m15 18-6-6 6-6"/></svg>;
        const Volume2 = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>;
        const Check = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polyline points="20 6 9 17 4 12"/></svg>;
        const X = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M18 6 6 18"/><path d="m6 6 18 18"/></svg>;
        const Sparkles = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 5h4"/><path d="M3 9h4"/></svg>;
        const Loader2 = (props) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>;

        // --- –î–ê–ù–ù–´–ï –ò –§–£–ù–ö–¶–ò–ò ---
        const shuffleArray = (array) => {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        };

        const WORD_DATABASE = {
            '–ó': [
                { id: 1, word: '–ó–ê–Ø–¶', position: 'start', emoji: 'üê∞' },
                { id: 2, word: '–ó–£–ë', position: 'start', emoji: 'ü¶∑' },
                { id: 3, word: '–ö–û–ó–ê', position: 'middle', emoji: 'üêê' },
                { id: 4, word: '–†–û–ó–ê', position: 'middle', emoji: 'üåπ' },
                { id: 5, word: '–ê–õ–ú–ê–ó', position: 'end', emoji: 'üíé' },
                { id: 6, word: '–ì–õ–ê–ó', position: 'end', emoji: 'üëÅÔ∏è' },
            ],
            '–õ': [
                { id: 7, word: '–õ–£–ù–ê', position: 'start', emoji: 'üåí' },
                { id: 8, word: '–õ–ê–ú–ü–ê', position: 'start', emoji: 'üí°' },
                { id: 9, word: '–ê–ö–£–õ–ê', position: 'middle', emoji: 'ü¶à' },
                { id: 10, word: '–ë–ï–õ–ö–ê', position: 'middle', emoji: 'üêøÔ∏è' },
                { id: 11, word: '–°–¢–û–õ', position: 'end', emoji: 'ü™ë' },
                { id: 12, word: '–ü–û–õ', position: 'end', emoji: '‚¨áÔ∏è' },
            ],
            '–ë': [
                { id: 13, word: '–ë–ê–ù–ê–ù', position: 'start', emoji: 'üçå' },
                { id: 14, word: '–ë–ê–†–ê–ë–ê–ù', position: 'start', emoji: 'ü•Å' },
                { id: 15, word: '–°–û–ë–ê–ö–ê', position: 'middle', emoji: 'üêï' },
                { id: 16, word: '–†–´–ë–ê', position: 'middle', emoji: 'üêü' },
                { id: 17, word: '–ì–†–ò–ë', position: 'end', emoji: 'üçÑ' },
                { id: 18, word: '–î–£–ë', position: 'end', emoji: 'üå≥' },
            ],
            '–ü': [
                { id: 19, word: '–ü–ê–£–ö', position: 'start', emoji: 'üï∑Ô∏è' },
                { id: 20, word: '–ü–û–ú–ò–î–û–†', position: 'start', emoji: 'üçÖ' },
                { id: 21, word: '–õ–û–ü–ê–¢–ê', position: 'middle', emoji: 'ü™£' },
                { id: 22, word: '–®–ê–ü–ö–ê', position: 'middle', emoji: 'üß¢' },
                { id: 23, word: '–°–£–ü', position: 'end', emoji: 'ü•£' },
                { id: 24, word: '–£–ö–†–û–ü', position: 'end', emoji: 'üåø' },
            ],
            '–î': [
                { id: 25, word: '–î–û–ú', position: 'start', emoji: 'üè†' },
                { id: 26, word: '–î–´–ù–Ø', position: 'start', emoji: 'üçà' },
                { id: 27, word: '–í–ï–î–†–û', position: 'middle', emoji: 'ü™£' },
                { id: 28, word: '–ü–û–î–ê–†–û–ö', position: 'middle', emoji: 'üéÅ' },
                { id: 29, word: '–°–ê–î', position: 'end', emoji: 'üå≥' },
                { id: 30, word: '–õ–Å–î', position: 'end', emoji: 'üßä' },
            ],
            ...Array.from({ length: 32 }, (_, i) => {
                const char = String.fromCharCode(1040 + i); 
                if (['–ó','–õ','–ë','–ü','–î','–Å','–ô','–™','–´','–¨'].includes(char)) return {};
                return { [char]: [] };
            }).reduce((acc, curr) => ({...acc, ...curr}), {})
        };

        const ALPHABET = [
            '–ê', '–ë', '–í', '–ì', '–î', '–ï', '–Å', '–ñ', '–ó', '–ò', '–ô',
            '–ö', '–õ', '–ú', '–ù', '–û', '–ü', '–†', '–°', '–¢', '–£', '–§',
            '–•', '–¶', '–ß', '–®', '–©', '–™', '–´', '–¨', '–≠', '–Æ', '–Ø'
        ];

        // –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –∞—É–¥–∏–æ
        const playAudioFromBase64 = (base64String) => {
            try {
                const binaryString = window.atob(base64String);
                const len = binaryString.length;
                const bytes = new Uint8Array(len);
                for (let i = 0; i < len; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }
                
                const wavHeader = new ArrayBuffer(44);
                const view = new DataView(wavHeader);
                const sampleRate = 24000; 
                const numChannels = 1;
                
                const writeString = (view, offset, string) => {
                    for (let i = 0; i < string.length; i++) {
                        view.setUint8(offset + i, string.charCodeAt(i));
                    }
                };

                writeString(view, 0, 'RIFF');
                view.setUint32(4, 36 + bytes.length, true);
                writeString(view, 8, 'WAVE');
                writeString(view, 12, 'fmt ');
                view.setUint32(16, 16, true);
                view.setUint16(20, 1, true);
                view.setUint16(22, numChannels, true);
                view.setUint32(24, sampleRate, true);
                view.setUint32(28, sampleRate * numChannels * 2, true);
                view.setUint16(32, numChannels * 2, true);
                view.setUint16(34, 16, true);
                writeString(view, 36, 'data');
                view.setUint32(40, bytes.length, true);

                const blob = new Blob([view, bytes], { type: 'audio/wav' });
                const url = URL.createObjectURL(blob);
                const audio = new Audio(url);
                audio.play();
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∞—É–¥–∏–æ:", error);
            }
        };

        // --- –ü–†–ò–õ–û–ñ–ï–ù–ò–ï ---
        function App() {
            const [currentScreen, setCurrentScreen] = useState('menu');
            const [selectedLetter, setSelectedLetter] = useState(null);
            const [currentWordsList, setCurrentWordsList] = useState([]);
            const [currentWordIndex, setCurrentWordIndex] = useState(0);
            const [isWordRevealed, setIsWordRevealed] = useState(false);
            const [feedback, setFeedback] = useState(null);
            const [score, setScore] = useState(0);
            
            // AI States
            const [isGenerating, setIsGenerating] = useState(false);
            const [isSpeaking, setIsSpeaking] = useState(false);
            const [generatedError, setGeneratedError] = useState(null);

            const currentWord = currentWordsList[currentWordIndex];

            // AI Functions
            const generateAIWord = async () => {
                if (!apiKey) {
                    alert("–ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AI, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å API –∫–ª—é—á –≤ –∫–æ–¥ —Ñ–∞–π–ª–∞ index.html!");
                    return;
                }
                if (!selectedLetter) return;
                setIsGenerating(true);
                setGeneratedError(null);

                try {
                    const prompt = `
                        Generate one simple Russian noun for a child that contains the letter '${selectedLetter}'. 
                        IMPORTANT: The consonant sound for '${selectedLetter}' in this word must be HARD (—Ç–≤—ë—Ä–¥—ã–π). 
                        Avoid words where '${selectedLetter}' is soft.
                        Ideally, pick a word that is NOT in this list: ${currentWordsList.map(w => w.word).join(', ')}.
                        Return ONLY a valid JSON object with this structure (no markdown): 
                        { "word": "WORD", "position": "start" | "middle" | "end", "emoji": "emoji" }
                    `;

                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            generationConfig: { responseMimeType: "application/json" }
                        })
                    });

                    const data = await response.json();
                    if (data.error) throw new Error(data.error.message);
                    
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    if (text) {
                        const newWordData = JSON.parse(text);
                        const newCard = {
                            id: Date.now(),
                            word: newWordData.word.toUpperCase(),
                            position: newWordData.position,
                            emoji: newWordData.emoji
                        };
                        
                        const newList = [...currentWordsList, newCard];
                        setCurrentWordsList(newList);
                        setCurrentWordIndex(newList.length - 1);
                        setIsWordRevealed(false);
                        setFeedback(null);
                    }
                } catch (error) {
                    console.error("Gemini Generation Error:", error);
                    setGeneratedError("–û—à–∏–±–∫–∞ AI. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á –∏–ª–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.");
                } finally {
                    setIsGenerating(false);
                }
            };

            const speakWord = async (text) => {
                if (!apiKey) {
                     alert("–ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–∑–≤—É—á–∫—É, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å API –∫–ª—é—á –≤ –∫–æ–¥ —Ñ–∞–π–ª–∞ index.html!");
                     return;
                }
                if (isSpeaking) return;
                setIsSpeaking(true);

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `–°–ª–æ–≤–æ: ${text}` }] }],
                            generationConfig: { 
                                responseModalities: ["AUDIO"],
                                speechConfig: { 
                                    voiceConfig: { 
                                        prebuiltVoiceConfig: { voiceName: "Kore" } 
                                    } 
                                } 
                            }
                        })
                    });

                    const data = await response.json();
                    const audioContent = data.candidates?.[0]?.content?.parts?.[0]?.inlineData?.data;

                    if (audioContent) {
                        playAudioFromBase64(audioContent);
                    }
                } catch (error) {
                    console.error("TTS Error:", error);
                } finally {
                    setIsSpeaking(false);
                }
            };

            // Game Logic
            const startGame = (letter) => {
                const words = WORD_DATABASE[letter];
                const initialList = words && words.length > 0 ? shuffleArray(words) : [];
                
                if (initialList.length === 0) {
                     // –ï—Å–ª–∏ –Ω–µ—Ç —Å–ª–æ–≤, –∏ –Ω–µ—Ç –∫–ª—é—á–∞ - –ø—Ä–æ—Å—Ç–æ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º –∏–ª–∏ –≥–æ–≤–æ—Ä–∏–º –æ–± —ç—Ç–æ–º
                     if (!apiKey) {
                         alert(`–î–ª—è –±—É–∫–≤—ã "${letter}" –ø–æ–∫–∞ –Ω–µ—Ç —Å–ª–æ–≤ –≤ –±–∞–∑–µ.`);
                         return;
                     }
                     if (!confirm(`–î–ª—è –±—É–∫–≤—ã "${letter}" –ø–æ–∫–∞ –Ω–µ—Ç —Å–ª–æ–≤ –≤ –±–∞–∑–µ. –•–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã AI –ø—Ä–∏–¥—É–º–∞–ª —Å–ª–æ–≤–∞?`)) {
                        return;
                    }
                }

                setSelectedLetter(letter);
                setCurrentWordsList(initialList);
                setCurrentWordIndex(0);
                setIsWordRevealed(false);
                setFeedback(null);
                setCurrentScreen('game');
            };

            const checkAnswer = (selectedPos) => {
                if (!currentWord) return;
                if (feedback === 'correct') return;

                if (selectedPos === currentWord.position) {
                    setFeedback('correct');
                    setScore(s => s + 1);
                } else {
                    setFeedback('wrong');
                }
            };

            const nextCard = () => {
                if (currentWordIndex < currentWordsList.length - 1) {
                    setCurrentWordIndex(prev => prev + 1);
                    setIsWordRevealed(false);
                    setFeedback(null);
                } else {
                    if(apiKey && confirm("–°–ª–æ–≤–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å! –•–æ—á–µ—à—å, —á—Ç–æ–±—ã —è –ø—Ä–∏–¥—É–º–∞–ª –Ω–æ–≤–æ–µ –≤–æ–ª—à–µ–±–Ω–æ–µ —Å–ª–æ–≤–æ?")) {
                        generateAIWord();
                    } else {
                        setCurrentScreen('menu');
                    }
                }
            };

            // Components
            const Train = () => {
                const getWindowStyle = (pos) => {
                    let baseStyle = 'bg-yellow-100 border-yellow-300';
                    const isCorrect = currentWord && feedback === 'correct' && currentWord.position === pos;
                    const isWrong = feedback === 'wrong';
                    
                    if (isCorrect) {
                        baseStyle = 'bg-green-400 border-green-500 shadow-[0_0_25px_rgba(74,222,128,0.9)] animate-pulse';
                    } else if (isWrong) {
                        baseStyle = 'bg-gray-200 border-gray-300 opacity-70';
                    }
                    return `${baseStyle} transition-all duration-300 flex items-center justify-center`;
                };

                const Wagon = ({ color, positionLabel, onClick, zIndex, isLocomotive = false }) => {
                    const windowStyle = getWindowStyle(positionLabel === '–ù–ê–ß–ê–õ–û' ? 'start' : positionLabel === '–°–ï–†–ï–î–ò–ù–ê' ? 'middle' : 'end');
                    
                    if (isLocomotive) {
                        return (
                            <div onClick={onClick} className={`relative flex flex-col items-center z-30 mr-1 group cursor-pointer active:scale-95 transition-transform`}>
                                <div className="w-32 h-36 rounded-xl border-4 border-red-800 bg-red-600 flex flex-col items-center justify-end relative shadow-xl pb-2">
                                    <div className="absolute -top-10 left-6 w-8 h-12 bg-red-800 rounded-t-lg border-2 border-red-900">
                                        <div className="absolute -top-4 left-2 w-6 h-4 bg-gray-100 rounded-full opacity-60 animate-ping"></div>
                                        <div className="absolute -top-8 left-0 w-10 h-6 bg-white rounded-full opacity-40 animate-pulse"></div>
                                    </div>
                                    <div className="absolute -top-2 left-0 right-0 h-4 bg-red-900 rounded-t-lg"></div>
                                    <div className={`mb-3 w-20 h-14 rounded-lg border-4 ${windowStyle}`}>
                                        <span className="text-[10px] font-bold text-gray-700">{positionLabel}</span>
                                    </div>
                                    <div className="absolute -left-3 bottom-0 w-6 h-16 bg-gray-700 rounded-l-lg transform skew-x-12 flex flex-col justify-end pb-2 gap-1">
                                        <div className="w-full h-1 bg-yellow-400 opacity-50"></div>
                                        <div className="w-full h-1 bg-yellow-400 opacity-50"></div>
                                    </div>
                                </div>
                                <div className="flex gap-1 -mb-6 z-20 ml-4">
                                    <div className="w-14 h-14 bg-gray-900 rounded-full border-[5px] border-gray-500 flex items-center justify-center animate-[spin_5s_linear_infinite]">
                                        <div className="w-3 h-3 bg-gray-500 rounded-full"></div>
                                    </div>
                                    <div className="w-10 h-10 bg-gray-900 rounded-full border-[4px] border-gray-500 flex items-center justify-center animate-[spin_5s_linear_infinite] self-end mb-1">
                                        <div className="w-2 h-2 bg-gray-500 rounded-full"></div>
                                    </div>
                                </div>
                            </div>
                        );
                    }
                    return (
                        <div onClick={onClick} className={`relative flex flex-col items-center group transition-transform active:scale-95 cursor-pointer ${zIndex}`}>
                            <div className={`w-32 h-28 rounded-xl border-4 border-${color}-700 bg-${color}-500 flex items-center justify-center relative shadow-lg`}>
                                    <div className={`absolute -top-2 left-0 right-0 h-3 bg-${color}-800 rounded-t-lg`}></div>
                                    <div className={`w-20 h-14 rounded-md border-4 ${windowStyle}`}>
                                        <span className="text-[10px] font-bold text-gray-600">{positionLabel}</span>
                                    </div>
                            </div>
                            <div className="absolute -left-4 bottom-8 w-6 h-3 bg-gray-800 rounded-full shadow-inner"></div>
                            <div className="flex gap-4 -mb-5 z-20">
                                <div className="w-10 h-10 bg-gray-900 rounded-full border-[4px] border-gray-400 flex items-center justify-center animate-[spin_5s_linear_infinite]">
                                    <div className="w-2 h-2 bg-gray-400 rounded-full"></div>
                                </div>
                                <div className="w-10 h-10 bg-gray-900 rounded-full border-[4px] border-gray-400 flex items-center justify-center animate-[spin_5s_linear_infinite]">
                                    <div className="w-2 h-2 bg-gray-400 rounded-full"></div>
                                </div>
                            </div>
                        </div>
                    );
                };

                return (
                    <div className="relative mt-16 w-full max-w-3xl mx-auto p-4 flex flex-col items-center">
                        <div className="flex items-end relative z-10 gap-2">
                            <Wagon isLocomotive={true} positionLabel="–ù–ê–ß–ê–õ–û" onClick={() => checkAnswer('start')} />
                            <Wagon color="blue" positionLabel="–°–ï–†–ï–î–ò–ù–ê" onClick={() => checkAnswer('middle')} zIndex="z-20" />
                            <Wagon color="green" positionLabel="–ö–û–ù–ï–¶" onClick={() => checkAnswer('end')} zIndex="z-10" />
                        </div>
                        <div className="relative w-full h-4 bg-gray-600 rounded-full mt-7 overflow-hidden border-t-2 border-gray-400"></div>
                        <div className="flex justify-between w-[110%] -ml-[5%] px-2 -mt-4 relative z-0">
                            {[...Array(25)].map((_, i) => (
                                <div key={i} className="w-3 h-5 bg-amber-900 rounded-sm shadow-sm"></div>
                            ))}
                        </div>
                    </div>
                );
            };

            const backgroundStyle = {
                backgroundImage: `url('data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 1600 800"%3E%3Cdefs%3E%3CradialGradient id="sky" cx="50%" cy="50%" r="50%" fx="50%" fy="50%"%3E%3Cstop offset="0%" style="stop-color:%23d6e9f4;stop-opacity:1"/%3E%3Cstop offset="100%" style="stop-color:%2387b8d4;stop-opacity:1"/%3E%3C/radialGradient%3E%3CradialGradient id="sun" cx="50%" cy="50%" r="50%" fx="50%" fy="50%"%3E%3Cstop offset="0%" style="stop-color:%23fff7cc;stop-opacity:1"/%3E%3Cstop offset="80%" style="stop-color:%23ffeb3b;stop-opacity:1"/%3E%3Cstop offset="100%" style="stop-color:%23fdd835;stop-opacity:0"/%3E%3C/radialGradient%3E%3Cfilter id="watercolor"%3E%3CfeTurbulence type="fractalNoise" baseFrequency="0.02" numOctaves="3" result="noise"/%3E%3CfeDisplacementMap in="SourceGraphic" in2="noise" scale="15" /%3E%3C/filter%3E%3C/defs%3E%3Crect width="100%" height="100%" fill="url(%23sky)" filter="url(%23watercolor)" opacity="0.6"/%3E%3Ccircle cx="150" cy="150" r="80" fill="url(%23sun)" filter="url(%23watercolor)" opacity="0.9" /%3E%3Cg opacity="0.5" transform="translate(0, 50)"%3E%3Cpath d="M-100 600 L180 300 L440 600 Z" fill="%23a8d5ba" filter="url(%23watercolor)"/%3E%3Cpath d="M300 650 L580 350 L860 650 Z" fill="%238fc0a5" filter="url(%23watercolor)"/%3E%3Cpath d="M700 600 L1000 320 L1300 600 Z" fill="%237cae92" filter="url(%23watercolor)"/%3E%3Cpath d="M1100 630 L1350 380 L1700 630 Z" fill="%23a8d5ba" filter="url(%23watercolor)"/%3E%3C/g%3E%3Cg opacity="0.7" transform="translate(0, 100)"%3E%3Cpath d="M0 800 L100 500 L200 800 Z" fill="%232e7d32" filter="url(%23watercolor)"/%3E%3Cpath d="M150 800 L300 450 L450 800 Z" fill="%2343a047" filter="url(%23watercolor)"/%3E%3Cpath d="M400 800 L600 550 L800 800 Z" fill="%232e7d32" filter="url(%23watercolor)"/%3E%3Cpath d="M750 800 L950 480 L1150 800 Z" fill="%2343a047" filter="url(%23watercolor)"/%3E%3Cpath d="M1100 800 L1300 520 L1500 800 Z" fill="%232e7d32" filter="url(%23watercolor)"/%3E%3Cpath d="M1450 800 L1600 500 L1750 800 Z" fill="%2343a047" filter="url(%23watercolor)"/%3E%3C/g%3E%3C/svg%3E')`,
                backgroundSize: 'cover',
                backgroundPosition: 'center bottom'
            };

            if (currentScreen === 'menu') {
                return (
                    <div className="min-h-screen p-4 font-sans flex flex-col items-center relative" style={backgroundStyle}>
                        <div className="absolute inset-0 bg-white/60 backdrop-blur-sm z-0"></div>
                        <header className="mb-8 text-center bg-white/90 p-6 rounded-3xl shadow-xl border-4 border-blue-200 w-full max-w-2xl relative z-10 backdrop-blur-md">
                            <h1 className="text-4xl font-extrabold text-blue-700 flex items-center justify-center gap-3 drop-shadow-sm">
                                üöÇ –ó–≤—É–∫–æ–≤–æ–π –ü–∞—Ä–æ–≤–æ–∑–∏–∫
                            </h1>
                            <p className="text-blue-500 mt-3 text-lg font-medium">–í—ã–±–µ—Ä–∏ –±—É–∫–≤—É –∏ –Ω–∞–π–¥–∏ –µ—ë –º–µ—Å—Ç–æ –≤ —Å–ª–æ–≤–µ!</p>
                        </header>

                        <div className="grid grid-cols-5 sm:grid-cols-6 gap-3 max-w-2xl w-full relative z-10">
                            {ALPHABET.map((letter) => (
                                <button
                                    key={letter}
                                    onClick={() => startGame(letter)}
                                    className={`
                                        aspect-square rounded-2xl text-2xl font-extrabold shadow-[0_4px_0_0_rgba(0,0,0,0.1)] transition-all
                                        hover:scale-105 active:scale-95 active:shadow-none flex items-center justify-center
                                        ${WORD_DATABASE[letter] && WORD_DATABASE[letter].length > 0 
                                        ? 'bg-gradient-to-br from-white to-blue-50 text-blue-700 border-2 border-blue-300 hover:border-blue-500 hover:from-blue-100' 
                                        : 'bg-white/50 text-gray-500 border-2 border-gray-200 hover:border-blue-300 hover:bg-blue-50/50 hover:text-blue-400'}
                                    `}
                                >
                                    {letter}
                                </button>
                            ))}
                        </div>
                        <div className="mt-8 text-sm text-blue-800 bg-white/70 px-4 py-2 rounded-full text-center max-w-md relative z-10 font-medium">
                            * –ù–∞–∂–º–∏ –Ω–∞ –ª—é–±—É—é –±—É–∫–≤—É! <span className="inline-flex items-center gap-1 font-bold text-purple-600"><Sparkles size={14}/> –í–æ–ª—à–µ–±–Ω—ã–π AI</span> (–Ω—É–∂–µ–Ω –∫–ª—é—á).
                        </div>
                    </div>
                );
            }

            if (!currentWord && !isGenerating) {
                return (
                    <div className="min-h-screen p-4 flex flex-col items-center justify-center relative" style={backgroundStyle}>
                        <div className="bg-white/90 p-8 rounded-3xl shadow-xl text-center z-10 max-w-md">
                            <h2 className="text-2xl font-bold text-blue-800 mb-4">–°–ª–æ–≤–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å!</h2>
                            <p className="mb-6 text-gray-600">–î–ª—è –±—É–∫–≤—ã "{selectedLetter}" —Å–ª–æ–≤ –≤ –±–∞–∑–µ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
                            <div className="flex flex-col gap-3">
                                <button 
                                    onClick={generateAIWord}
                                    className="bg-purple-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-purple-700 flex items-center justify-center gap-2"
                                >
                                    <Sparkles /> –ü—Ä–∏–¥—É–º–∞—Ç—å —Å–ª–æ–≤–æ (AI)
                                </button>
                                <button 
                                    onClick={() => setCurrentScreen('menu')}
                                    className="bg-gray-200 text-gray-700 px-6 py-3 rounded-xl font-bold hover:bg-gray-300"
                                >
                                    –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –º–µ–Ω—é
                                </button>
                            </div>
                        </div>
                    </div>
                )
            }

            return (
                <div className="min-h-screen p-4 font-sans flex flex-col items-center relative overflow-hidden" style={backgroundStyle}>
                    <div className="absolute inset-0 bg-white/40 backdrop-blur-[2px] z-0"></div>
                
                    {/* HEADER */}
                    <div className="w-full max-w-lg flex justify-between items-center mb-6 relative z-10">
                        <button 
                            onClick={() => setCurrentScreen('menu')}
                            className="p-2 bg-white/80 rounded-full shadow-md hover:bg-white transition-colors"
                        >
                            <ChevronLeft className="text-blue-700 w-6 h-6" />
                        </button>
                        <div className="text-3xl font-extrabold text-blue-800 bg-white/80 px-8 py-3 rounded-full shadow-md border-2 border-blue-200 backdrop-blur-md">
                            –ë—É–∫–≤–∞ "{selectedLetter}"
                        </div>
                        <div className="flex items-center gap-1 bg-yellow-400/90 px-4 py-2 rounded-full shadow-md border-2 border-yellow-200">
                            <Star className="w-5 h-5 text-white fill-current" />
                            <span className="font-black text-white text-xl">{score}</span>
                        </div>
                    </div>

                    {/* ERROR DISPLAY */}
                    {generatedError && (
                        <div className="relative z-20 mb-4 bg-red-100 text-red-700 px-4 py-2 rounded-lg border border-red-300 flex items-center gap-2 animate-shake">
                            <X size={16} /> {generatedError}
                        </div>
                    )}

                    {/* FLASHCARD AREA */}
                    <div className="flex-1 w-full max-w-lg flex flex-col items-center justify-center mb-4 relative z-10">
                        
                        {isGenerating ? (
                            <div className="w-72 h-72 rounded-[2.5rem] bg-white/80 backdrop-blur border-[6px] border-purple-200 flex flex-col items-center justify-center animate-pulse shadow-xl">
                                <Loader2 className="w-16 h-16 text-purple-600 animate-spin mb-4" />
                                <span className="text-purple-800 font-bold text-lg">–ü—Ä–∏–¥—É–º—ã–≤–∞—é —Å–ª–æ–≤–æ...</span>
                            </div>
                        ) : (
                            <div className="relative group perspective-1000 w-72 h-72">
                                <div 
                                    onClick={() => setIsWordRevealed(!isWordRevealed)}
                                    className={`
                                        cursor-pointer
                                        relative w-full h-full duration-500 preserve-3d transition-all
                                        bg-gradient-to-br from-white to-gray-50 rounded-[2.5rem] shadow-2xl border-[6px] border-white flex flex-col items-center justify-center p-6
                                        ${isWordRevealed ? 'rotate-y-180' : ''}
                                    `}
                                >
                                    <div className="text-[10rem] filter drop-shadow-lg transform group-hover:scale-105 transition-transform">
                                        {currentWord?.emoji}
                                    </div>
                                    
                                    <div className="absolute bottom-5 bg-white/60 px-3 py-1 rounded-full text-gray-500 text-sm flex items-center gap-2 opacity-70 group-hover:opacity-100 transition-opacity">
                                        <span className="font-medium">–ù–∞–∂–º–∏, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å–ª–æ–≤–æ</span>
                                    </div>

                                    {isWordRevealed && (
                                    <div className="absolute inset-0 bg-white/95 backdrop-blur-md rounded-[2.3rem] flex items-center justify-center z-10 animate-fade-in border-[6px] border-blue-200">
                                        <span className="text-4xl font-black text-blue-900 tracking-wider uppercase drop-shadow-sm text-center px-2">
                                            {currentWord?.word}
                                        </span>
                                    </div>
                                    )}
                                </div>

                                <div className="absolute -right-16 top-0 flex flex-col gap-3">
                                    <button 
                                        onClick={(e) => { e.stopPropagation(); generateAIWord(); }}
                                        disabled={isGenerating}
                                        className="w-12 h-12 rounded-full bg-purple-500 text-white flex items-center justify-center shadow-lg hover:bg-purple-600 active:scale-95 transition-all border-2 border-purple-300"
                                        title="–ü—Ä–∏–¥—É–º–∞—Ç—å –Ω–æ–≤–æ–µ —Å–ª–æ–≤–æ (AI)"
                                    >
                                        {isGenerating ? <Loader2 className="animate-spin" size={20}/> : <Sparkles size={24} />}
                                    </button>
                                    
                                    <button 
                                        onClick={(e) => { e.stopPropagation(); speakWord(currentWord?.word); }}
                                        disabled={isSpeaking}
                                        className={`w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-all border-2
                                            ${isSpeaking ? 'bg-green-600 text-white border-green-400' : 'bg-blue-500 text-white hover:bg-blue-600 border-blue-300'}
                                        `}
                                        title="–ü—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏ —Å–ª–æ–≤–æ"
                                    >
                                        {isSpeaking ? <Loader2 className="animate-spin" size={20}/> : <Volume2 size={24} />}
                                    </button>
                                </div>
                            </div>
                        )}

                        <div className="h-16 mt-6 flex items-center justify-center min-w-[300px]">
                            {feedback === 'correct' && (
                                <div className="flex items-center gap-3 text-green-600 bg-green-100/80 px-6 py-3 rounded-2xl font-extrabold text-2xl animate-bounce shadow-lg border-2 border-green-300 backdrop-blur-sm">
                                    <Check size={32} strokeWidth={3} />
                                    <span>–ü—Ä–∞–≤–∏–ª—å–Ω–æ!</span>
                                </div>
                            )}
                            {feedback === 'wrong' && (
                                <div className="flex items-center gap-3 text-red-600 bg-red-100/80 px-6 py-3 rounded-2xl font-extrabold text-2xl animate-shake shadow-lg border-2 border-red-300 backdrop-blur-sm">
                                    <X size={32} strokeWidth={3} />
                                    <span>–ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑</span>
                                </div>
                            )}
                            {!feedback && !isGenerating && (
                                <span className="text-blue-800 bg-white/60 px-6 py-3 rounded-full text-xl font-bold shadow-sm backdrop-blur-sm">–ì–¥–µ –∑–≤—É–∫ "{selectedLetter}"?</span>
                            )}
                        </div>

                    </div>

                    <div className="w-full pb-8 relative z-10">
                        <Train />
                        
                        {feedback === 'correct' && (
                            <div className="flex justify-center mt-8 gap-4">
                                <button 
                                    onClick={nextCard}
                                    className="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-10 py-4 rounded-2xl font-extrabold text-xl shadow-[0_6px_0_0_#1e40af] hover:shadow-[0_3px_0_0_#1e40af] hover:translate-y-1 transition-all flex items-center gap-3 border-2 border-blue-400"
                                >
                                    –°–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ <ChevronLeft className="rotate-180 w-7 h-7" strokeWidth={3} />
                                </button>
                            </div>
                        )}
                    </div>

                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>